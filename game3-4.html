<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Casino - Super Slots</title>
    <link rel="apple-touch-icon" href="icon.png">
    <style>
        body { font-family: 'Apple SD Gothic Neo', sans-serif; background-color: #111; color: white; margin: 0; display: flex; flex-direction: column; height: 100vh; overflow: hidden; }
        
        /* í—¤ë” */
        .header { 
            padding: 15px; background: #222; border-bottom: 2px solid #333;
            display: flex; justify-content: space-between; align-items: center; 
            box-shadow: 0 4px 10px rgba(0,0,0,0.5); z-index: 20;
        }
        .title-group { display: flex; align-items: center; gap: 8px; }
        .btn-help {
            width: 24px; height: 24px; border-radius: 50%; background: white; color: #333;
            border: none; font-weight: bold; font-size: 14px; cursor: pointer;
            display: flex; justify-content: center; align-items: center;
        }
        .money-box { font-size: 18px; font-weight: bold; color: #f1c40f; text-shadow: 1px 1px 0 #000; }
        
        /* ìŠ¬ë¡¯ ë¨¸ì‹  ìŠ¤í…Œì´ì§€ */
        .stage { 
            flex: 1; display: flex; flex-direction: column; justify-content: center; align-items: center; 
            background: radial-gradient(circle, #2c0b4a 0%, #000 100%); /* ë³´ë¼ìƒ‰ ë„¤ì˜¨ ëŠë‚Œ */
            position: relative; 
        }

        /* ìŠ¬ë¡¯ ê¸°ê³„ ë³¸ì²´ */
        .slot-machine {
            background: linear-gradient(135deg, #e67e22, #d35400);
            padding: 15px; border-radius: 20px;
            box-shadow: 0 10px 0 #a04000, 0 0 50px rgba(230, 126, 34, 0.3);
            border: 4px solid #f1c40f;
            position: relative;
        }
        .slot-title { text-align: center; font-weight: bold; color: #333; margin-bottom: 10px; background: #f1c40f; border-radius: 5px; font-size: 14px; padding: 2px; }

        /* ë¦´ ì°½ë¬¸ */
        .reels-container {
            display: flex; gap: 10px; background: #000; padding: 10px; border-radius: 10px;
            border: 4px solid #333; box-shadow: inset 0 0 20px #000;
        }
        
        .reel {
            width: 70px; height: 100px; 
            background: white; border-radius: 5px;
            display: flex; justify-content: center; align-items: center;
            font-size: 50px; color: #333;
            box-shadow: inset 0 0 15px rgba(0,0,0,0.5);
            overflow: hidden; position: relative;
        }
        /* ëŒì•„ê°€ëŠ” íš¨ê³¼ (ë¸”ëŸ¬) */
        .reel.spinning { color: transparent; text-shadow: 0 0 10px rgba(0,0,0,0.5); }
        .reel.spinning::after {
            content: 'ğŸ’ğŸ‹ğŸ‡ğŸ’7ï¸âƒ£'; /* ì”ìƒ íš¨ê³¼ */
            position: absolute; top: -20px; left: 0; width: 100%;
            font-size: 40px; line-height: 50px; text-align: center; color: rgba(0,0,0,0.3);
            animation: spinBlur 0.2s linear infinite;
        }
        
        @keyframes spinBlur { 0% { transform: translateY(0); } 100% { transform: translateY(-50px); } }
        
        /* ìŠ¹ë¦¬ íš¨ê³¼ */
        .win-glow { animation: flash 0.5s infinite; border: 4px solid #fff !important; }
        @keyframes flash { 0% { box-shadow: 0 0 10px gold; } 50% { box-shadow: 0 0 40px red; } 100% { box-shadow: 0 0 10px gold; } }

        .msg-box { margin-top: 20px; height: 30px; font-weight: bold; font-size: 18px; text-align: center; color: #f1c40f; text-shadow: 0 2px 2px #000; }

        /* ì»¨íŠ¸ë¡¤ íŒ¨ë„ */
        .control-panel { background: #fff; color: #333; padding: 20px; border-top-left-radius: 20px; border-top-right-radius: 20px; box-shadow: 0 -5px 20px rgba(0,0,0,0.5); z-index: 10;}
        
        .bet-input-group { display: flex; gap: 10px; margin-bottom: 20px; }
        .input-money { flex: 1; padding: 10px; font-size: 18px; border: 2px solid #ccc; border-radius: 8px; text-align: right; font-weight: bold; }
        .btn-set { background: #95a5a6; color: white; border: none; border-radius: 8px; padding: 0 10px; font-weight: bold; cursor: pointer; font-size: 12px; }

        .spin-area { display: flex; gap: 10px; }
        .btn-spin { 
            flex: 2; background: #e74c3c; color: white; font-size: 24px; font-weight: bold; 
            border: none; border-radius: 12px; padding: 15px; 
            box-shadow: 0 5px 0 #c0392b; transition: 0.1s;
        }
        .btn-spin:active { transform: translateY(5px); box-shadow: none; }
        .btn-spin:disabled { background: #555; box-shadow: none; color: #aaa; cursor: not-allowed; }

        .btn-sub { flex: 1; border: none; border-radius: 12px; font-weight: bold; cursor: pointer; color: white; font-size: 14px; }
        .btn-back { background: #7f8c8d; box-shadow: 0 5px 0 #5f6c6d; }
        .btn-back:active { transform: translateY(5px); box-shadow: none; }
        .btn-reset { background: #e67e22; box-shadow: 0 5px 0 #d35400; }
        .btn-reset:active { transform: translateY(5px); box-shadow: none; }

        /* ë„ì›€ë§ ëª¨ë‹¬ (ìµœìƒë‹¨ ê³ ì •) */
        .modal { 
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
            background: rgba(0,0,0,0.85); z-index: 9999; 
            display: none; justify-content: center; align-items: center; 
            backdrop-filter: blur(2px);
        }
        .modal-content { 
            background: #fff; color: #333; width: 85%; max-width: 350px; 
            max-height: 85vh; overflow-y: auto; padding: 25px; 
            border-radius: 15px; border: 4px solid #f1c40f;
        }
        .modal-title { font-size: 22px; font-weight: bold; text-align: center; border-bottom: 2px solid #eee; padding-bottom: 10px; margin-bottom: 15px; }
        .pay-table { width: 100%; border-collapse: collapse; margin-bottom: 15px; font-size: 14px; }
        .pay-table td { padding: 5px; border-bottom: 1px solid #eee; }
        .pay-table td:last-child { text-align: right; font-weight: bold; color: #c0392b; }
        .modal-close { width: 100%; padding: 12px; background: #333; color: white; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; }

    </style>
</head>
<body>

    <div class="header">
        <div class="title-group">
            <span>ğŸ° SUPER SLOTS</span>
            <button class="btn-help" onclick="toggleHelp()">?</button>
        </div>
        <div class="money-box" id="wallet-bal">0</div>
    </div>

    <div class="stage">
        <div class="slot-machine" id="machine-body">
            <div class="slot-title">JACKPOT x77</div>
            <div class="reels-container">
                <div class="reel" id="reel-1">7ï¸âƒ£</div>
                <div class="reel" id="reel-2">7ï¸âƒ£</div>
                <div class="reel" id="reel-3">7ï¸âƒ£</div>
            </div>
        </div>
        <div class="msg-box" id="msg-box">ë°°íŒ…í•˜ê³  ëŒë¦¬ì„¸ìš”!</div>
    </div>

    <div class="control-panel">
        <div class="bet-input-group">
            <input type="number" id="bet-input" class="input-money" placeholder="ë°°íŒ…ê¸ˆì•¡">
            <button class="btn-set" onclick="addBet(100)">+100</button>
            <button class="btn-set" onclick="addBet(1000)">+1ì²œ</button>
            <button class="btn-set" onclick="addBet(10000)">+1ë§Œ</button>
            <button class="btn-set" style="background:#c0392b;" onclick="addBet('ALL')">ì˜¬ì¸</button>
        </div>

        <div class="spin-area">
            <button class="btn-sub btn-back" onclick="location.href='game3.html'">ë‚˜ê°€ê¸°</button>
            <button class="btn-sub btn-reset" onclick="resetBet()">ì´ˆê¸°í™”</button>
            <button id="btn-spin" class="btn-spin" onclick="spinSlots()">SPIN!</button>
        </div>
    </div>

    <div id="help-modal" class="modal" onclick="toggleHelp()">
        <div class="modal-content" onclick="event.stopPropagation()">
            <div class="modal-title">ğŸ’° ë°°ë‹¹í‘œ (Payout)</div>
            <table class="pay-table">
                <tr><td>7ï¸âƒ£ 7ï¸âƒ£ 7ï¸âƒ£ (ì­íŒŸ)</td><td>x 77ë°°</td></tr>
                <tr><td>ğŸ’ ğŸ’ ğŸ’ (ë‹¤ì´ì•„)</td><td>x 20ë°°</td></tr>
                <tr><td>ğŸ‰ ğŸ‰ ğŸ‰ (ê³¼ì¼)</td><td>x 10ë°°</td></tr>
                <tr><td>ğŸ‡ ğŸ‡ ğŸ‡ (ê³¼ì¼)</td><td>x 10ë°°</td></tr>
                <tr><td>ğŸ‹ ğŸ‹ ğŸ‹ (ì†Œë°•)</td><td>x 5ë°°</td></tr>
                <tr><td>ğŸ’ ğŸ’ ğŸ’ (ì†Œë°•)</td><td>x 5ë°°</td></tr>
                <tr><td>7ï¸âƒ£ 7ï¸âƒ£ â“ (ì•„ê¹Œë¹„)</td><td>x 2ë°°</td></tr>
            </table>
            <div style="font-size:12px; color:#666; margin-bottom:15px; text-align:center;">
                * 2ê°œë§Œ ë§ì•„ë„ ë³´ë„ˆìŠ¤ê°€ í„°ì§ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤!<br>
                * ì¸ìƒì€ í•œë°©! ì­íŒŸì„ ë…¸ë¦¬ì„¸ìš”.
            </div>
            <button class="modal-close" onclick="toggleHelp()">ë‹«ê¸°</button>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, doc, getDoc, updateDoc, increment } 
        from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = {
          apiKey: "AIzaSyDTMfB6Fl6QiiJdcTjpcU9nha2GP4Ne_6o",
          authDomain: "lovechatproject-2db11.firebaseapp.com",
          projectId: "lovechatproject-2db11",
          storageBucket: "lovechatproject-2db11.firebasestorage.app",
          messagingSenderId: "1069136590072",
          appId: "1:1069136590072:web:7712e718db03c70bff370d",
          measurementId: "G-ERG2LL283F"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        let myId = localStorage.getItem('chat_uid');
        const userRef = doc(db, "users", myId);

        let myBalance = 0;
        let isSpinning = false;

        // ì‹¬ë³¼ ì •ì˜ (í™•ë¥  ê°€ì¤‘ì¹˜ ì ìš©ì„ ìœ„í•´ ë°°ì—´ êµ¬ì„±)
        // 7(ì­íŒŸ)ì€ ì ê²Œ, ì²´ë¦¬/ë ˆëª¬ì€ ë§ê²Œ
        const SYMBOLS_POOL = [
            '7ï¸âƒ£', '7ï¸âƒ£', // 2ê°œ (í¬ê·€)
            'ğŸ’', 'ğŸ’', 'ğŸ’', // 3ê°œ
            'ğŸ‰', 'ğŸ‰', 'ğŸ‰', 'ğŸ‰', // 4ê°œ
            'ğŸ‡', 'ğŸ‡', 'ğŸ‡', 'ğŸ‡', 
            'ğŸ‹', 'ğŸ‹', 'ğŸ‹', 'ğŸ‹', 'ğŸ‹', 
            'ğŸ’', 'ğŸ’', 'ğŸ’', 'ğŸ’', 'ğŸ’', 'ğŸ’'
        ];
        // í‘œì‹œìš© ì „ì²´ ì‹¬ë³¼
        const ALL_SYMBOLS = ['7ï¸âƒ£', 'ğŸ’', 'ğŸ‰', 'ğŸ‡', 'ğŸ‹', 'ğŸ’'];

        getDoc(userRef).then(snap => {
            if(snap.exists()) {
                myBalance = snap.data().coins;
                updateUI();
            }
        });

        window.toggleHelp = () => {
            const el = document.getElementById('help-modal');
            el.style.display = (el.style.display === 'flex') ? 'none' : 'flex';
        };

        window.addBet = (amt) => {
            if(isSpinning) return;
            const input = document.getElementById('bet-input');
            let current = parseInt(input.value) || 0;
            let target = (amt === 'ALL') ? myBalance : current + amt;
            if(target > myBalance) target = myBalance;
            input.value = target;
        };

        window.resetBet = () => {
            if(isSpinning) return;
            document.getElementById('bet-input').value = '';
        };

        function getRandomSymbol() {
            return SYMBOLS_POOL[Math.floor(Math.random() * SYMBOLS_POOL.length)];
        }

        // ë¦´ ëŒë¦¬ëŠ” ì• ë‹ˆë©”ì´ì…˜ í•¨ìˆ˜
        function animateReel(reelId, duration, finalSymbol) {
            const reel = document.getElementById(reelId);
            reel.classList.add('spinning');
            
            // 0.1ì´ˆë§ˆë‹¤ ì‹¬ë³¼ ëœë¤ ë³€ê²½ (ì”ìƒ íš¨ê³¼)
            const interval = setInterval(() => {
                reel.innerText = ALL_SYMBOLS[Math.floor(Math.random() * ALL_SYMBOLS.length)];
            }, 80);

            // ì§€ì •ëœ ì‹œê°„ í›„ ë©ˆì¶¤
            setTimeout(() => {
                clearInterval(interval);
                reel.classList.remove('spinning');
                reel.innerText = finalSymbol;
                // ì¿µ! í•˜ëŠ” ëŠë‚Œì„ ìœ„í•´ ì‚´ì§ ì»¤ì¡Œë‹¤ ì‘ì•„ì§€ê¸°
                reel.style.transform = "scale(1.2)";
                setTimeout(() => reel.style.transform = "scale(1)", 150);
            }, duration);
        }

        window.spinSlots = async () => {
            const betInput = document.getElementById('bet-input');
            const betMoney = parseInt(betInput.value) || 0;

            if(betMoney <= 0) return alert("ë°°íŒ…ê¸ˆì„ ì…ë ¥í•˜ì„¸ìš”!");
            if(betMoney > myBalance) return alert("ì”ì•¡ì´ ë¶€ì¡±í•©ë‹ˆë‹¤.");

            // ê²Œì„ ì‹œì‘
            isSpinning = true;
            document.getElementById('btn-spin').disabled = true;
            document.getElementById('machine-body').classList.remove('win-glow'); // íš¨ê³¼ ì œê±°
            document.getElementById('msg-box').innerText = "í–‰ìš´ì„ ë¹•ë‹ˆë‹¤...";
            document.getElementById('msg-box').style.color = "#fff";

            // ëˆ ì°¨ê°
            myBalance -= betMoney;
            updateUI();
            await updateDoc(userRef, { coins: myBalance });

            // ê²°ê³¼ ë¯¸ë¦¬ ê²°ì •
            const r1 = getRandomSymbol();
            const r2 = getRandomSymbol();
            const r3 = getRandomSymbol();

            // ë¦´ íšŒì „ (ì‹œê°„ì°¨ ê³µê²©)
            animateReel('reel-1', 1000, r1);
            animateReel('reel-2', 1500, r2); // 0.5ì´ˆ ë” ë
            animateReel('reel-3', 2200, r3); // 0.7ì´ˆ ë” ë (ìª¼ëŠ” ë§›)

            // ê²°ê³¼ íŒì • (ëª¨ë“  ë¦´ì´ ë©ˆì¶˜ í›„)
            setTimeout(async () => {
                let multiplier = 0;
                let msg = "";
                let color = "#e74c3c"; // ê¸°ë³¸ íŒ¨ë°°ìƒ‰

                // ìŠ¹ë¦¬ ë¡œì§
                if (r1 === r2 && r2 === r3) {
                    // 1. 3ê°œ ëª¨ë‘ ë˜‘ê°™ì„ ë•Œ (ëŒ€ë°•)
                    if(r1 === '7ï¸âƒ£') { multiplier = 77; msg = "ğŸš¨ ì­íŒŸ! 77ë°°! ğŸš¨"; color = "#f1c40f"; }
                    else if(r1 === 'ğŸ’') { multiplier = 20; msg = "ë‹¤ì´ì•„ëª¬ë“œ! (x20)"; color = "#2ecc71"; }
                    else if(r1 === 'ğŸ‰' || r1 === 'ğŸ‡') { multiplier = 10; msg = "ë‚˜ì´ìŠ¤! (x10)"; color = "#2ecc71"; }
                    else { 
                        // ë ˆëª¬, ì²´ë¦¬ ë“± ë‚˜ë¨¸ì§€ ì‹¬ë³¼ 3ê°œ
                        multiplier = 5; msg = "ì†Œë°• ë‹¹ì²¨ (x5)"; color = "#3498db"; 
                    }
                } 
                else if (r1 === r2 || r2 === r3 || r1 === r3) {
                    // 2. [ì¶”ê°€ë¨] 2ê°œë¼ë„ ë˜‘ê°™ì„ ë•Œ (ì†Œì†Œí•œ ì´ë“)
                    // 7ì€ íŠ¹ë³„í•˜ë‹ˆê¹Œ ë°°ë‹¹ì„ ì¢€ ë” ì¤ë‹ˆë‹¤
                    if ( (r1===r2 && r1==='7ï¸âƒ£') || (r2===r3 && r2==='7ï¸âƒ£') || (r1===r3 && r1==='7ï¸âƒ£') ) {
                        multiplier = 3; msg = "ëŸ­í‚¤ì„¸ë¸ íˆ¬í˜ì–´! (x3)"; color = "#e67e22";
                    } else {
                        // ë‚˜ë¨¸ì§€ ì‹¬ë³¼ 2ê°œ ì¼ì¹˜ (ë³¸ì „ + ìš©ëˆ)
                        multiplier = 1.5; msg = "2ê°œ ì¼ì¹˜! (x1.5)"; color = "#95a5a6";
                    }
                }

                const msgBox = document.getElementById('msg-box');
                
                if (multiplier > 0) {
                    const winMoney = Math.floor(betMoney * multiplier);
                    myBalance += winMoney;
                    await updateDoc(userRef, { coins: increment(winMoney) });
                    
                    msgBox.innerText = `${msg} (+${winMoney.toLocaleString()})`;
                    msgBox.style.color = color;
                    
                    // ì­íŒŸ/ê³ ë°°ë‹¹ ì‹œ ê¸°ê³„ ë²ˆì©ê±°ë¦¼
                    if(multiplier >= 10) document.getElementById('machine-body').classList.add('win-glow');
                } else {
                    msgBox.innerText = "ê½... ë‹¤ìŒ ê¸°íšŒì—!";
                    msgBox.style.color = "#e74c3c";
                }

                updateUI();
                isSpinning = false;
                document.getElementById('btn-spin').disabled = false;

            }, 2300); // ë¦´3 ë©ˆì¶”ê³  0.1ì´ˆ ë’¤
        };

        function updateUI() {
            document.getElementById('wallet-bal').innerText = myBalance.toLocaleString();
        }
    </script>
</body>
</html>